package learners.com;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;

import java.util.Optional;

@Service
public class LearnerService {

    @Autowired
    private LearnerRepository learnerRepository; 

    // Method to save a new learner
    public Learner saveLearner(Learner learner) {
        return learnerRepository.save(learner);
    }

    // Method to fetch all learners with pagination
    public Page<Learner> findAll(Pageable pageable) {
        return learnerRepository.findAll(pageable);
    }

    // Method to search learners by first name
    public Page<Learner> searchLearners(String firstname, Pageable pageable) {
        return learnerRepository.findByfirstnameContainingIgnoreCase(firstname, pageable);
    }

    // Method to get a learner by ID
    public Optional<Learner> getLearnerById(Long id) {
        return learnerRepository.findById(id);
    }

    // Method to update an existing learner
    public Learner updateLearner(Long id, Learner learnerDetails) {
        Learner existingLearner = learnerRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Learner not found with id: " + id));

        existingLearner.setFirstName(learnerDetails.getfirstName());
        existingLearner.setLastName(learnerDetails.getlastName()); // Adjusted method name
        existingLearner.setIdProof(learnerDetails.getIdProof());
        existingLearner.setPhone(learnerDetails.getPhone());
        existingLearner.setDateOfBirth(learnerDetails.getDateOfBirth());
        existingLearner.setEmail(learnerDetails.getEmail());
        existingLearner.setRegisteredDate(learnerDetails.getRegisteredDate());
        existingLearner.setLocation(learnerDetails.getLocation());
        existingLearner.setBatchIds(learnerDetails.getBatchIds());
        existingLearner.setAlternatePhone(learnerDetails.getAlternatePhone());
        existingLearner.setDescription(learnerDetails.getDescription());
        existingLearner.setExchangeRate(learnerDetails.getExchangeRate());
        existingLearner.setSource(learnerDetails.getSource());
        existingLearner.setAttendedDemo(learnerDetails.getAttendedDemo());
        existingLearner.setLearnerOwner(learnerDetails.getLearnerOwner());
        existingLearner.setLearnerStage(learnerDetails.getLearnerStage());
        existingLearner.setCurrency(learnerDetails.getCurrency());
        existingLearner.setLeadCreatedTime(learnerDetails.getLeadCreatedTime());
        existingLearner.setCounsellingDoneBy(learnerDetails.getCounsellingDoneBy());
        existingLearner.setRegisteredCourse(learnerDetails.getRegisteredCourse());
        existingLearner.setPreferableTime(learnerDetails.getPreferableTime());
        existingLearner.setTechStack(learnerDetails.getTechStack());
        existingLearner.setBatchTiming(learnerDetails.getBatchTiming());
        existingLearner.setCourseComments(learnerDetails.getCourseComments());
        existingLearner.setModeOfClass(learnerDetails.getModeOfClass());
        existingLearner.setSlackAccess(learnerDetails.getSlackAccess());
        existingLearner.setComment(learnerDetails.getComment());
        existingLearner.setLmsAccess(learnerDetails.getLmsAccess());

        return learnerRepository.save(existingLearner);
    }

    // Method to delete a learner
    public void deleteLearner(Long id) {
        learnerRepository.deleteById(id);
    }
}
